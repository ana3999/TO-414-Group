---
title: "Hotels and Booking Cancellations"
author: "Ana Imam, Jihan Khandaker, Supreet Nirman, Al Shumyatcher, Mihir Zaveri"
date: "February 21st, 2021"
output: 
  html_document: 
    toc: yes
    toc_float: yes
---

## Introduction

In this project, we are utilizing the data set of hotel bookings to address the problem of cancellations. This is an important issue for hotels from a business standpoint, as cancellations result in a loss of potential revenue and limit the optimization of the hotel's service levels. Our analyses of this data set are aimed to help the management teams of both the City Hotel and Resort Hotel to better predict the likelihood of cancellation. With this, the hotels can then employ an overbooking method that can optimize the capacity-based revenue management. 

#### Approach

In approaching this data set, we will first separate the data for the City Hotel and the Resort Hotel. For both hotels, we have narrowed down a number of booking features that we believe have a significant correlation with the probability of cancellation. From this, we have developed a profile of probabilities that can be applied to any future bookings. Hotels can then use this profile to calculate the cancellation probability of future bookings and consider the option of overbooking. 

#### Data set-up
```{r}
hotels <- read.csv("hotel_bookings.csv")
rhotels <- hotels[hotels$hotel == "Resort Hotel",]
chotels <- hotels[hotels$hotel == "City Hotel",]
```

## Variable  Omission

  This data set provides information on many of the different features of hotel bookings. However, we have realized that not every feature is a useful variable in predicting cancellation probabilities, and thus, have been omitted:

**Arrival_date_year**: Since these are the years of the recorded bookings, they are not predictive of bookings in future years

**Arrival_date_week_number** & **Arrival_date_day_of_month**: These variables both have excessive variation and are also unnecessary given the analysis of the arrival months of the bookings

**adults**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$adults <- as.factor(rhotels$adults)
sort(summary(rhotels$adults), decreasing = TRUE) [1:5]
```
```{r}
chotels$adults <- as.factor(chotels$adults)
sort(summary(chotels$adults), decreasing = TRUE) [1:5]
```

**meal**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$meal <- as.factor(rhotels$meal)
sort(summary(rhotels$meal), decreasing = TRUE) [1:5]
```
```{r}
chotels$meal <- as.factor(chotels$meal)
sort(summary(chotels$meal), decreasing = TRUE) [1:5]
```

**distribution_channel**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$distribution_channel <- as.factor(rhotels$distribution_channel)
sort(summary(rhotels$distribution_channel), decreasing = TRUE) [1:5]
```
```{r}
chotels$distribution_channel <- as.factor(chotels$distribution_channel)
sort(summary(chotels$distribution_channel), decreasing = TRUE) [1:5]
```

**is_repeated_guest**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$is_repeated_guest <- as.factor(rhotels$is_repeated_guest)
sort(summary(rhotels$is_repeated_guest), decreasing = TRUE) [1:5]
```
```{r}
chotels$is_repeated_guest <- as.factor(chotels$is_repeated_guest)
sort(summary(chotels$is_repeated_guest), decreasing = TRUE) [1:5]
```

**previous_cancellations**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$previous_cancellations <- as.factor(rhotels$previous_cancellations)
sort(summary(rhotels$previous_cancellations), decreasing = TRUE) [1:5]
```
```{r}
chotels$previous_cancellations <- as.factor(chotels$previous_cancellations)
sort(summary(chotels$previous_cancellations), decreasing = TRUE) [1:5]
```

**previous_bookings_not_canceled**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$previous_bookings_not_canceled <- as.factor(rhotels$previous_bookings_not_canceled)
sort(summary(rhotels$previous_bookings_not_canceled), decreasing = TRUE) [1:5]
```
```{r}
chotels$previous_bookings_not_canceled <- as.factor(chotels$previous_bookings_not_canceled)
sort(summary(chotels$previous_bookings_not_canceled), decreasing = TRUE) [1:5]
```

**reserved_room_type**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$reserved_room_type <- as.factor(rhotels$reserved_room_type)
sort(summary(rhotels$reserved_room_type), decreasing = TRUE) [1:5]
```
```{r}
chotels$reserved_room_type <- as.factor(chotels$reserved_room_type)
sort(summary(chotels$reserved_room_type), decreasing = TRUE) [1:5]
```

**assigned_room_type**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$assigned_room_type <- as.factor(rhotels$assigned_room_type)
sort(summary(rhotels$assigned_room_type), decreasing = TRUE) [1:5]
```
```{r}
chotels$assigned_room_type <- as.factor(chotels$assigned_room_type)
sort(summary(chotels$assigned_room_type), decreasing = TRUE) [1:5]
```

**booking_changes**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$booking_changes <- as.factor(rhotels$booking_changes)
sort(summary(rhotels$booking_changes), decreasing = TRUE) [1:5]
```
```{r}
chotels$booking_changes <- as.factor(chotels$booking_changes)
sort(summary(chotels$booking_changes), decreasing = TRUE) [1:5]
```

**deposit_type**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$deposit_type <- as.factor(rhotels$deposit_type)
sort(summary(rhotels$deposit_type), decreasing = TRUE) [1:5]
```
```{r}
chotels$deposit_type <- as.factor(chotels$deposit_type)
sort(summary(chotels$deposit_type), decreasing = TRUE) [1:5]
```

**company**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$company <- as.factor(rhotels$company)
sort(summary(rhotels$company), decreasing = TRUE) [1:5]
```
```{r}
chotels$company <- as.factor(chotels$company)
sort(summary(chotels$company), decreasing = TRUE) [1:5]
```

**days_in_waiting_list**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$days_in_waiting_list <- as.factor(rhotels$days_in_waiting_list)
sort(summary(rhotels$days_in_waiting_list), decreasing = TRUE) [1:5]
```
```{r}
chotels$days_in_waiting_list <- as.factor(chotels$days_in_waiting_list)
sort(summary(chotels$days_in_waiting_list), decreasing = TRUE) [1:5]
```

**customer_type**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$customer_type <- as.factor(rhotels$customer_type)
sort(summary(rhotels$customer_type), decreasing = TRUE) [1:5]
```
```{r}
chotels$customer_type <- as.factor(chotels$customer_type)
sort(summary(chotels$customer_type), decreasing = TRUE) [1:5]
```

**adr**: since this feature records, lodging transactions rates, it is irrelevant to cancellations

**required_car_parking_spaces**: as shown below, this feature lacks variability in both hotel populations, so it cannot be predictive of cancellations
```{r}
rhotels$required_car_parking_spaces <- as.factor(rhotels$required_car_parking_spaces)
sort(summary(rhotels$required_car_parking_spaces), decreasing = TRUE) [1:5]
```
```{r}
chotels$required_car_parking_spaces <- as.factor(chotels$required_car_parking_spaces)
sort(summary(chotels$required_car_parking_spaces), decreasing = TRUE) [1:5]
```




## Resort Hotel 

### Variable Analyses

**Lead_time**
```{r}
r_leadtime_cancel <- tapply(rhotels$is_canceled, rhotels$lead_time, mean, na.rm = TRUE)
plot(r_leadtime_cancel, xlab = "Lead Time in days")
```


**arrival_date_month**
```{r}
rhotels$arrival_date_month <- as.factor(rhotels$arrival_date_month)
rcancelledbymonth <- tapply(rhotels$is_canceled, rhotels$arrival_date_month, mean, na.rm = TRUE)
summary(rhotels$arrival_date_month)
sort(rcancelledbymonth, decreasing = TRUE)
```


**Stays_in_weekend_nights**
```{r}
r_weekend_cancel <- tapply(rhotels$is_canceled, rhotels$stays_in_weekend_nights, mean, na.rm = TRUE)
plot(r_weekend_cancel, xlab = "Weekend Days Booked")
```

**Stays_in_week_nights**
```{r}
r_weekday_cancel <- tapply(rhotels$is_canceled, rhotels$stays_in_week_nights, mean, na.rm = TRUE)
plot(r_weekday_cancel, xlab = "Weekday Days Booked")
```

**children**: children=1 or not=0
```{r}
rhotels$children2 <- ifelse(rhotels$children > 0, 1, 0)
rhotels$children2 <- as.factor(rhotels$children2)
r_cancel_children <- tapply(rhotels$is_canceled, rhotels$children2, mean, na.rm = TRUE)
r_cancel_children
```


**babies**: babies=1 or not=0
```{r}
rhotels$babies2 <- ifelse(rhotels$babies > 0, 1, 0)
rhotels$babies2 <- as.factor(rhotels$babies2)
r_cancel_babies <- tapply(rhotels$is_canceled, rhotels$babies2, mean, na.rm = TRUE)
r_cancel_babies
```

**country**
```{r}
rhotels$country <- as.factor(rhotels$country)
rcancelledbycountry <- tapply(rhotels$is_canceled, rhotels$country, sum, na.rm = TRUE)
summary(rhotels$country)[1:15]
sort(rcancelledbycountry, decreasing = TRUE)[1:15]

```

**market_segment**
```{r}
rhotels$market_segment <- as.factor(rhotels$market_segment)
rcancelledbymarket <- tapply(rhotels$is_canceled, rhotels$market_segment, mean, na.rm = TRUE)
summary(rhotels$market_segment)
sort(rcancelledbymarket, decreasing = TRUE)
```

**agent**
```{r}
rcancelledbyagent <- tapply(rhotels$is_canceled, rhotels$agent, mean, na.rm = TRUE)
sort(rcancelledbyagent, decreasing = TRUE)
```

**total_of_special_requests**
```{r}
rcancelledbyrequest <- tapply(rhotels$is_canceled, rhotels$total_of_special_requests, mean, na.rm = TRUE)
sort(rcancelledbyrequest, decreasing = TRUE)
```

### Graphs

### Booking Profile

## City Hotel 

### Variable Analyses
**Lead_time**
```{r}
c_leadtime_cancel <- tapply(chotels$is_canceled, chotels$lead_time, mean, na.rm = TRUE)
plot(c_leadtime_cancel, xlab = "Lead Time in days")
```


**arrival_date_month**
```{r}
chotels$arrival_date_month <- as.factor(chotels$arrival_date_month)
ccancelledbymonth <- tapply(chotels$is_canceled, chotels$arrival_date_month, mean, na.rm = TRUE)
summary(chotels$arrival_date_month)
sort(ccancelledbymonth, decreasing = TRUE)
```

**Stays_in_weekend_nights**
```{r}
c_weekend_cancel <- tapply(chotels$is_canceled, chotels$stays_in_weekend_nights, mean, na.rm = TRUE)
plot(c_weekend_cancel, xlab = "Weekend Days Booked")
```

**Stays_in_week_nights**
```{r}
c_weekday_cancel <- tapply(chotels$is_canceled, chotels$stays_in_week_nights, mean, na.rm = TRUE)
plot(c_weekday_cancel, xlab = "Weekday Days Booked")
```

**children**: children=1 or not=0
```{r}
chotels$children2 <- ifelse(chotels$children > 0, 1, 0)
chotels$children2 <- as.factor(chotels$children2)
c_cancel_children <- tapply(chotels$is_canceled, chotels$children2, mean, na.rm = TRUE)
c_cancel_children
```

**babies**: babies=1 or not=0
```{r}
chotels$babies2 <- ifelse(chotels$babies > 0, 1, 0)
chotels$babies2 <- as.factor(chotels$babies2)
c_cancel_babies <- tapply(chotels$is_canceled, chotels$babies2, mean, na.rm = TRUE)
c_cancel_babies
```

**country**
```{r}
chotels$country <- as.factor(chotels$country)
ccancelledbycountry <- tapply(chotels$is_canceled, chotels$country, sum, na.rm = TRUE)
summary(chotels$country)[1:15]
sort(ccancelledbycountry, decreasing = TRUE)[1:15]
```

**market_segment**
```{r}
chotels$market_segment <- as.factor(chotels$market_segment)
ccancelledbymarket <- tapply(chotels$is_canceled, chotels$market_segment, mean, na.rm = TRUE)
summary(chotels$market_segment)
sort(ccancelledbymarket, decreasing = TRUE)
```

**agent**
```{r}
rcancelledbyagent <- tapply(rhotels$is_canceled, rhotels$agent, mean, na.rm = TRUE)
sort(rcancelledbyagent, decreasing = TRUE)
```

**total_of_special_requests**
```{r}
rcancelledbyrequest <- tapply(rhotels$is_canceled, rhotels$total_of_special_requests, mean, na.rm = TRUE)
sort(rcancelledbyrequest, decreasing = TRUE)
```


### Graphs

### Booking Profile

## Conclusion

